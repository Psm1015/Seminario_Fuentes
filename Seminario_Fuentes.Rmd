---
title: "Relación de la obesidad con el desempleo y la alimentación"
author: "Diego González Sánchez, Pablo Santamaría Miguel, Juan Hernando Quintana"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## **URL repositorio GitHub**
https://github.com/Psm1015/Seminario_Fuentes.git

## **Datos utilizadas**
En este apartado es donde se indican las URL´s que se van a utilizar durante el desarrollo de este proyecto. 

- [Datos obesidad](https://datos.gob.es/es/catalogo/ea0010587-indice-de-masa-corporal-poblacion-adulta-segun-sexo-grupo-de-edad-y-nivel-de-estudios-poblacion-de-18-y-mas-anos-identificador-api-t15-p420-a2019-p06-l0-01005-px1)

- [Datos desempleo](https://datos.gob.es/es/catalogo/ea0010587-parados-por-tiempo-de-busqueda-de-empleo-sexo-y-grupo-de-edad-epa-identificador-api-66002)

- [Datos alimentación](https://datos.gob.es/es/catalogo/ea0010587-patron-de-consumo-de-determinados-alimentos-segun-sexo-y-grupo-de-edad-poblacion-de-15-y-mas-anos-identificador-api-t15-p420-a2019-p06-l0-05001-px1)

## **Introducción**
La obesidad es una enfermedad crónica común que se caracteriza por una acumulación anormal de grasa en el cuerpo, que no es saludable.

Aunque existen influencias genéticas, conductuales, metabólicas y hormonales en el peso corporal, la obesidad ocurre cuando se ingieren más calorías de las que se queman con las actividades diarias típicas y el ejercicio. El cuerpo almacena ese exceso de calorías en forma de grasa.

En este caso se realizará un estudio de como se ve afectada la obesidad en relación con el desempleo y la alimentación  respecto a la edad.

## **Objetivo general**
• Relación entre la obesidad, nivel de estudios, sexo y edad.

• Relación entre desempleo y obesidad.

• Relación entre alimentación y rangos de edad.

## **Paquetes utilizados**
Explícación de las distintas librerias utilizadas durante el desarrollo del proyecto:

1. library(dplyr)
Dplyr nos permite seleccionar, modificar, filtrar y agrupar los datos con los que hemos trabajado de forma sencilla.

```{r , eval = FALSE}
library(dplyr)
```

2. library(tidyverse)
Utilizamos tidyverse para importar, transformar y manipular los datos con los que trabajamos.

```{r , eval = FALSE}
library(tidyverse)
```

3. library(pxR)
Nos permite leer y manipular acrhivos que se encuentran en formato pc axis.

```{r , eval = FALSE}
library(pxR)
```

4. library(ggplot2)
Utilizamos esta librería para representar mediante gráficos los datos.

```{r , eval = FALSE}
library(ggplot2)
```

## **Manipulación de datos**
Los archivox .px son un formato estándar para almacenar datos estadísticos en forma de tablas multidimensionales.
Iniciálmente nuestros datos px no se encontraban en una codificacion UTF-8 y nos daba problemas al intentar visualizar los datos al inicio ya que contienen carácteres extraños como la 'ñ'.
Para solucionar nuestro problema convertimos la coficación de nuestros archivos, los cuales estaban en 'ISO-8859-1' a la codificación 'UTF-8'.
De esta forma ya podiamos visualizar y manipular nuestros datos.

## **Importación de datos**
En este apartado, se proporciona el código necesario para importar los archivos pc-axis de IMC, alimentación y desempleo

- IMC
```{r , eval = TRUE, warning = FALSE}
IMC <- readLines("INPUT/DATA/Indice-masa-corporal.px", encoding = "ISO-8859-1")
IMC_utf8 <- iconv(IMC, from = "ISO-8859-1", to = "UTF-8")
```

- Alimentación
```{r , eval = TRUE, warning = FALSE}
Alimentacion <- readLines("INPUT/DATA/Alimentacion.px", encoding = "ISO-8859-1")
Alimentacion_utf8 <- iconv(Alimentacion, from = "ISO-8859-1", to = "UTF-8")
```

- Desempleo
```{r , eval = FALSE, warning = FALSE}
archivo_texto <- readLines("INPUT/DATA/Desempleo.px", encoding = "ISO-8859-1")
archivo_texto_utf8 <- iconv(archivo_texto, from = "ISO-8859-1", to = "UTF-8")
```

## **Análisis de datos**
En el archvido desempleo trabajaremos solo con los datos obtenidos del año 2021 en función del tiempo de búsqueda de empleo.

En el archivo alimentación analizaremos las distintas frecuencias con las que las personas del mismo rango de edades anterior consumen carne, pescado, dulces etc

En el archivo IMC (indice de masa corporal) estudiaremos el peso corporal de las personas según su nivel de estudios.

En todos ellos trabajaremos con unos rangos de edades de 8 a 24 años, 25 a 64 años y de 65 o más años.
Debido a como estaban estructurados los datos solo hemos tenido que establecer los rangos de edades en Alimentación y desempleo.

-Alimentación
```{r , eval = FALSE, warning = FALSE}
datos <- read.px(archivo_utf8)

DF <- as.data.frame(datos)
DF

# Filter para quitar diversos rangos de edad
DF1 <- DF %>%
  filter(!(Edad %in% c("De 25 a 34 aÃ±os", "De 45 a 54 aÃ±os", "De 55 a 64 aÃ±os", "De 75 y mÃ¡s aÃ±os")))
DF1

# Crear otra columna (Grupo_Edad) cambiando los rangos de Edad
datos_df <- DF1 %>%
mutate(Grupo_edad = case_when(
    Edad == "De 15 a 24 aÃ±os" ~ "De 18 a 24 aÃ±os",
#    Edad == "De 25 a 34 aÃ±os" ~ "De 25 a 64 aÃ±os",
    Edad == "De 35 a 44 aÃ±os" ~ "De 25 a 64 aÃ±os",
#    Edad == "De 45 a 54 aÃ±os" ~ "De 25 a 64 aÃ±os",
#   Edad == "De 55 a 64 aÃ±os" ~ "De 25 a 64 aÃ±os",
    Edad == "De 65 a 74 aÃ±os" ~ "De 65 y mÃ¡s aÃ±os",
#    Edad == "De 75 y mÃ¡s aÃ±os" ~ "De 65 y mÃ¡s aÃ±os"
  ))
datos_df
```

Ahora se van a eliminar diversas filas para tener los datos preparados para poder ser trabajados.
```{r , eval = FALSE, warning = FALSE}
# ELIMINAR TODAS LAS FILAS QUE TENGAN NA EN LA COLUMNA Grupo_edad
df_sin_NA <- datos_df %>% 
  filter(!is.na(Grupo_edad))
df_sin_NA

#ELIMINAR LA COLUMNA EDAD
Alimentacion_df <- df_sin_NA %>% 
  select(-Edad)

datos_Alimentacion <-  Alimentacion_df %>%
  filter(
    Frecuencia != "TOTAL",                                  # Excluir frecuencia total
  )
```



-Desempleo
```{r , eval = FALSE, warning = FALSE}
datos <- read.px(archivo_utf8)

df11 <- as.data.frame(datos)
df11

#Rango de edades: 18 a 24, 25 a 64, 65 o más
#Agrpuamineto de las edades por los rangos que hemos deifinifo
Desempleo_full <- df11 %>%
  mutate(Grupo_edad = case_when(
    Edad == "De 16 a 19 aÃ±os" ~ "18 a 24 aÃ±os",
    Edad == "De 20 a 24 aÃ±os" ~ "18 a 24 aÃ±os",
    Edad == "De 25 a 29 aÃ±os" ~ "25 a 64 aÃ±os",
    Edad == "De 30 a 34 aÃ±os" ~ "25 a 64 aÃ±os",
    Edad == "De 35 a 39 aÃ±os" ~ "25 a 64 aÃ±os",
    Edad == "De 40 a 44 aÃ±os" ~ "25 a 64 aÃ±os",
    Edad == "De 45 a 49 aÃ±os" ~ "25 a 64 aÃ±os",
    Edad == "De 50 a 54 aÃ±os" ~ "25 a 64 aÃ±os",
    Edad == "De 55 a 59 aÃ±os" ~ "25 a 64 aÃ±os",
    Edad == "De 60 a 64 aÃ±os" ~ "25 a 64 aÃ±os",
    Edad == "De 65 a 69 aÃ±os" ~ "65 o mÃ¡s",
    Edad =="70 y mÃ¡s aÃ±os" ~ '65 o mÃ¡s',
  ))

#Eliminar filas es la que salia el valor NA
Desempleo_full1 <- Desempleo_full[-c((1:144), (1873:2016), (3745:3888)), ]
Desempleo_full1

Desempleo_df <- Desempleo_full1 %>% select(-Edad)
```



## **Resultados**
En este apartado se van a mostrar los resultados de las estudio realizado en los diferentes sets de datos. En primer lugar, se mostrará el resultado del estudio de IMC. 

```{r , echo = FALSE}
datos_obesidad <- data.frame(
  Edad = rep(c("De 18 a 24 años", "De 25 a 64 años", "De 65 y más años"), each = 6),
  Sexo = rep(c("Hombres", "Mujeres"), times = 9),
  Nivel.de.estudios = rep(c("Básico e inferior", "Intermedio", "Superior"), times = 6),
  value = c(7.20, 3.00, 2.81, 10.77, 3.41, 1.82, 
            22.22, 14.40, 11.62, 20.47, 16.26, 9.20, 
            22.09, 14.23, 12.61, 24.68, 16.15, 10.97)
)
library(ggplot2)
ggplot(datos_obesidad, aes(x = Nivel.de.estudios, y = value, fill = Sexo)) +
  geom_bar(stat = "identity", position = "dodge") +
  facet_wrap(~ Edad) +
  labs(
    title = "Media de valores de obesidad por Nivel de estudios, Sexo y Edad",
    x = "Nivel de estudios",
    y = "Valor de obesidad promedio"
  ) +
  scale_fill_manual(values = c("Hombres" = "steelblue", "Mujeres" = "salmon")) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)
  )
```

Viendo este resultado se pueden sacar diferentes conclusiones sobre que porcentaje de personas padecen obesidad relacionado con la edad, nivel de estudios y sexo.

