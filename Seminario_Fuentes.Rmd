---
title: "Relación de la obesidad con el desempleo y la alimentación"
author: "Diego González Sánchez, Pablo Santamaría Miguel, Juan Hernando Quintana"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## **Introducción**
La obesidad es una enfermedad crónica común que se caracteriza por una acumulación anormal de grasa en el cuerpo, que no es saludable.

Aunque existen influencias genéticas, conductuales, metabólicas y hormonales en el peso corporal, la obesidad ocurre cuando se ingieren más calorías de las que se queman con las actividades diarias típicas y el ejercicio. El cuerpo almacena ese exceso de calorías en forma de grasa.

En este caso se realizará un estudio de como se ve afectada la obesidad en relación con el desempleo y la alimentación  respecto a la edad.

## **Objetivo general**
• Relación entre la obesidad, nivel de estudios, sexo y edad.

• Relación entre desempleo y obesidad.

• Relación entre alimentación y rangos de edad.

## **Paquetes utilizados**
Explícación de las distintas librerias utilizadas durante el desarrollo del proyecto:

1. library(dplyr)
Dplyr nos permite seleccionar, modificar, filtrar y agrupar los datos con los que hemos trabajado de forma sencilla.

```{r , eval = FALSE}
library(dplyr)
```

2. library(tidyverse)
Utilizamos tidyverse para importar, transformar y manipular los datos con los que trabajamos.

```{r , eval = FALSE}
library(tidyverse)
```

3. library(pxR)
Nos permite leer y manipular acrhivos que se encuentran en formato pc axis.

```{r , eval = FALSE}
library(pxR)
```

4. library(ggplot2)
Utilizamos esta librería para representar mediante gráficos los datos.

```{r , eval = FALSE}
library(ggplot2)
```

## **Manipulación de datos**
Los archivox .px son un formato estándar para almacenar datos estadísticos en forma de tablas multidimensionales.
Iniciálmente nuestros datos px no se encontraban en una codificacion UTF-8 y nos daba problemas al intentar visualizar los datos al inicio ya que contienen carácteres extraños como la 'ñ'.
Para solucionar nuestro problema convertimos la coficación de nuestros archivos, los cuales estaban en 'ISO-8859-1' a la codificación 'UTF-8'.
De esta forma ya podiamos visualizar y manipular nuestros datos.

## **Análisis de datos**
En el archvido desempleo trabajaremos solo con los datos obtenidos del año 2021 en función del tiempo de búsqueda de empleo.

En el archivo alimentación analizaremos las distintas frecuencias con las que las personas del mismo rango de edades anterior consumen carne, pescado, dulces etc

En el archivo IMC (indice de masa corporal) estudiaremos el peso corporal de las personas según su nivel de estudios.

En todos ellos trabajaremos con unos rangos de edades de 8 a 24 años, 25 a 64 años y de 65 o más años.

## **Importación de datos**
En este apartado, se proporciona el código necesario para importar los archivos pc-axis de IMC, alimentación y desempleo

- IMC
```{r , eval = TRUE, warning = FALSE}
IMC <- readLines("INPUT/DATA/Indice-masa-corporal.px", encoding = "ISO-8859-1")
IMC_utf8 <- iconv(IMC, from = "ISO-8859-1", to = "UTF-8")
```

- Alimentación
```{r , eval = TRUE, warning = FALSE}
Alimentacion <- readLines("INPUT/DATA/Alimentacion.px", encoding = "ISO-8859-1")
Alimentacion_utf8 <- iconv(Alimentacion, from = "ISO-8859-1", to = "UTF-8")
```

- Desempleo
```{r , eval = FALSE, warning = FALSE}
archivo_texto <- readLines("INPUT/DATA/Desempleo.px", encoding = "ISO-8859-1")
archivo_texto_utf8 <- iconv(archivo_texto, from = "ISO-8859-1", to = "UTF-8")
```

## **Resultados**
En este apartado se van a mostrar los resultados de las estudio realizado en los diferentes sets de datos. En primer lugar, se mostrará el resultado del estudio de IMC. 

```{r , echo = FALSE}
datos_obesidad <- data.frame(
  Edad = rep(c("De 18 a 24 años", "De 25 a 64 años", "De 65 y más años"), each = 6),
  Sexo = rep(c("Hombres", "Mujeres"), times = 9),
  Nivel.de.estudios = rep(c("Básico e inferior", "Intermedio", "Superior"), times = 6),
  value = c(7.20, 3.00, 2.81, 10.77, 3.41, 1.82, 
            22.22, 14.40, 11.62, 20.47, 16.26, 9.20, 
            22.09, 14.23, 12.61, 24.68, 16.15, 10.97)
)
library(ggplot2)
ggplot(datos_obesidad, aes(x = Nivel.de.estudios, y = value, fill = Sexo)) +
  geom_bar(stat = "identity", position = "dodge") +
  facet_wrap(~ Edad) +
  labs(
    title = "Media de valores de obesidad por Nivel de estudios, Sexo y Edad",
    x = "Nivel de estudios",
    y = "Valor de obesidad promedio"
  ) +
  scale_fill_manual(values = c("Hombres" = "steelblue", "Mujeres" = "salmon")) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)
  )
```
Viendo este resultado se pueden sacar diferentes conclusiones sobre que porcentaje de personas padecen obesidad relacionado con la edad, nivel de estudios y sexo.

- Ahora se va a mostrar una gráfica sobre que porcentaje de personas come comida rápida por sexo y edad.
```{r , echo = FALSE}
library(pxR)
Alimentacion <- readLines("INPUT/DATA/Alimentacion.px", encoding = "ISO-8859-1")
Alimentacion_utf8 <- iconv(Alimentacion, from = "ISO-8859-1", to = "UTF-8")
archivo_utf8 <- tempfile(fileext = ".px")
writeLines(Alimentacion_utf8, archivo_utf8)

# Lee el archivo temporal con read.px
datos <- read.px(archivo_utf8)

#str(datos$Edad)

# Ver la estructura del archivo cargado
# str(Desempleo)
#a <-unlist(Desempleo)
#a
# Convertir a un data frame para trabajar con los datos

#Rango de edades: 18 a 24, 25 a 64, 65 o más


DF <- as.data.frame(datos)
DF

# Filter para quitar diversos rangos de edad
DF1 <- DF %>%
  filter(!(Edad %in% c("De 25 a 34 aÃ±os", "De 45 a 54 aÃ±os", "De 55 a 64 aÃ±os", "De 75 y mÃ¡s aÃ±os")))
DF1

# Crear otra columna (Grupo_Edad) cambiando los rangos de Edad
datos_df <- DF1 %>%
mutate(Grupo_edad = case_when(
    Edad == "De 15 a 24 aÃ±os" ~ "De 18 a 24 aÃ±os",
#    Edad == "De 25 a 34 aÃ±os" ~ "De 25 a 64 aÃ±os",
    Edad == "De 35 a 44 aÃ±os" ~ "De 25 a 64 aÃ±os",
#    Edad == "De 45 a 54 aÃ±os" ~ "De 25 a 64 aÃ±os",
#   Edad == "De 55 a 64 aÃ±os" ~ "De 25 a 64 aÃ±os",
    Edad == "De 65 a 74 aÃ±os" ~ "De 65 y mÃ¡s aÃ±os",
#    Edad == "De 75 y mÃ¡s aÃ±os" ~ "De 65 y mÃ¡s aÃ±os"
  ))
datos_df

# ELIMINAR TODAS LAS FILAS QUE TENGAN NA EN LA COLUMNA Grupo_edad
df_sin_NA <- datos_df %>% 
  filter(!is.na(Grupo_edad))
df_sin_NA

#ELIMINAR LA COLUMNA EDAD
Alimentacion_df <- df_sin_NA %>% 
  select(-Edad)

datos_Alimentacion <-  Alimentacion_df %>%
  filter(
    Frecuencia != "TOTAL",                                  # Excluir frecuencia total
  )
# GRÁFICA QUE RELACIONA EL PORCENTAJE DE PERSONAS POR SEXO Y RANGO DE EDAD QUE COME COMIDA RAPIDA  
# 1 O 2 VECES A LA SEMANA
Alimentacion_rapida <- datos_Alimentacion %>%
  filter(
    Frecuencia == "1 o 2 veces a la semana",
    Alimentos == "Comida rÃ¡pida"
  )

ggplot(Alimentacion_rapida, aes(x = Grupo_edad, y = value, fill = Sexo)) +
  geom_bar(stat = "identity", position = "dodge") +  
  labs(
    title = "Porcentaje de Consumo de comida rapida 1 o 2 veces a la Semana",
    x = "Rango de Edad",
    y = "Porcentaje de Personas"
  ) +
  scale_fill_manual(values = c("Hombres" = "steelblue", "Mujeres" = "salmon", "Ambos sexos" = "yellow")) +  
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)
  )
```







